
#Librerias ----
library(readr)
library(tidyverse)



#Dataframes ----

#Lectura de dataframes. Para leer los archivos csv usamos el comando read_csv.

clima_aeroparque_BA_2022 <- read_csv("Data/Clima_Aeroparque_BA.csv")

bike_trips_2022 <- read_csv("Data/trips_2022_reducido.csv")

#Filtramos el dataframe de bicis
bike_trips_2022_5_to_60_min <- bike_trips_2022 %>% 
  filter(between(duracion_recorrido, left = 60*5, right = 60*60))

#Dtaframe de bicis filtrado con 3 variables mas: mes, dia de la semana y horario
month_day_hour_bike_trips_2022_5_to_60_min <- bike_trips_2022_5_to_60_min %>% 
  mutate(month = months(fecha_origen_recorrido), hour = hour(fecha_origen_recorrido), week_day = wday(fecha)) %>% 
  mutate(week_day = case_when(week_day == 1 ~ "Sunday",
                              week_day == 2 ~ "Monday",
                              week_day == 3 ~ "Tuesday",
                              week_day == 4 ~ "Wednesday",
                              week_day == 5 ~ "Thursday",
                              week_day == 6 ~ "Friday",
                              week_day == 7 ~ "Saturday"))
         


#Dtaframe del clima con 1 variables mas: mes
clima_aeroparque_BA_2022_bymonth <- clima_aeroparque_BA_2022 %>% 
  mutate(month = months(date)) 

  
  


#Dataframe bike_trips_2022_5_to_60_min ----

#esto es un resumen del datarframe de bicis con viajes entre 5 a 20 minutos
summary_bike_trips_2022_5_to_60_min <- summary(bike_trips_2022_5_to_60_min) 

#visualizacion de viajes en minutos
trips_duration_in_minutes <- bike_trips_2022_5_to_60_min %>% 
  mutate(duracion_recorrido = duracion_recorrido/60) %>% 
  ggplot(mapping = aes(x = duracion_recorrido)) +
  geom_histogram(colour = "#E6AC6E", fill = "beige", bins = 11) +
  labs(x = "Duracion", y = "Cantidad", title = "Duracion de los recorridos en minutos")

#dataframe con el viaje promedio y la mediana
promedio_y_mediana_de_viajes <-  bike_trips_2022_5_to_60_min %>% 
  mutate(duracion_recorrido = duracion_recorrido/60) %>% 
  summarise("viaje promedio" = mean(duracion_recorrido), mediana = median(duracion_recorrido))

#visualizacion de viajes por mes
trips_by_month <- month_day_hour_bike_trips_2022_5_to_60_min %>% 
  ggplot(mapping = aes(x = fct_relevel(month, c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")))) +
  geom_bar(fill = "mintcream", colour = "lightskyblue") +
  labs(x = "Mes", y = "Cantidad")

#visualizacion de viajes por dia
trips_by_day <- month_day_hour_bike_trips_2022_5_to_60_min %>% 
  ggplot(mapping = aes(x = fct_relevel(week_day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))))+
  geom_bar(fill = "mintcream", colour = "lightskyblue")

#visualizacion de viajes por hora
trips_by_hour <- month_day_hour_bike_trips_2022_5_to_60_min %>% 
  ggplot(mapping = aes(x = hour)) +
  geom_bar(fill = "mintcream", colour = "lightskyblue") +
  labs(x = "Horario", y = "Cantidad")

#visualizacion de viajes por mes y hora
trips_by_month_and_hour <- month_day_hour_bike_trips_2022_5_to_60_min %>% 
  group_by(month) %>% 
  ggplot(mapping = aes(x = hour)) +
  geom_bar() +
  facet_wrap(~fct_relevel(month, c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")))

#visualizacion de viajes por dia y hora
trips_by_day_and_hour <- month_day_hour_bike_trips_2022_5_to_60_min %>% 
  group_by(week_day) %>% 
  ggplot(mapping = aes(x = hour)) +
  geom_bar() +
  facet_wrap(~fct_relevel(week_day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")))

#dataframe con la cantidad de estaciones de origen 
origin_trip <- bike_trips_2022_5_to_60_min %>% 
  select(id_estacion_origen, nombre_estacion_origen) %>% 
  group_by(id_estacion_origen, nombre_estacion_origen) %>% 
  summarise(amount_by_station = n()) %>% 
  arrange(desc(amount_by_station))

#dataframe con la cantidad de estaciones de llegada
destination_trip <- bike_trips_2022_5_to_60_min %>% 
  select(id_estacion_destino, nombre_estacion_destino) %>% 
  group_by(id_estacion_destino, nombre_estacion_destino) %>% 
  summarise(amount_by_station = n()) %>% 
  arrange(desc(amount_by_station)) 

#viajes mas comunes
common_trips <- bike_trips_2022_5_to_60_min %>% 
  select(id_estacion_origen, nombre_estacion_origen, id_estacion_destino, nombre_estacion_destino) %>% 
  group_by(id_estacion_origen, nombre_estacion_origen, id_estacion_destino, nombre_estacion_destino) %>% 
  summarise(amount = n()) %>% 
  arrange(desc(amount))

#tipo de bici
bike_type <- bike_trips_2022_5_to_60_min %>% 
  select(modelo_bicicleta) %>% 
  ggplot(mapping = aes(x = modelo_bicicleta, fill = modelo_bicicleta)) +
  geom_bar()

#uso de bicis por genero
use_of_bikes_by_gender <- bike_trips_2022_5_to_60_min %>% 
  select(Género) %>% 
  filter(!is.na(Género)) %>% 
  ggplot(mapping = aes(x = Género, fill = Género)) + 
  geom_bar()


#Dataframe clima_aeroparque_BA_2022 ----

#dataframe summary del clima
summary_weather <- summary(clima_aeroparque_BA_2022)

#grafico de temperaturas por mes
grafico_temperatura_por_mes <- clima_aeroparque_BA_2022_bymonth %>% 
  select(tmin, tmax, tavg, month) %>% 
  group_by(month) %>% 
  summarise(tmin_by_month = mean(tmin), tmax_by_month = mean(tmax), tavg_by_month = mean(tavg)) %>% 
  ggplot(mapping = aes(x = fct_relevel(month, c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")), y = tmax_by_month)) +
  geom_point(colour = "red", size = 4) +
  geom_point(aes(x = fct_relevel(month, c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")), y = tmin_by_month), color = "blue", size = 4)

#grafico de temperaturas por dia
grafico_temperatura_por_dia <- clima_aeroparque_BA_2022_bymonth %>% ggplot(mapping = aes(x = date, y = tmax)) +
  geom_line(colour = "red") +
  geom_line(aes(y = tmin), colour = "blue")

#precipitaciones por mes
precipitaciones_por_mes <- clima_aeroparque_BA_2022_bymonth %>% 
  group_by(month) %>% 
  filter(!is.na(prcp)) %>% 
  summarise(precipitation_by_month = mean(prcp)) %>% 
  ggplot(mapping = aes(x = fct_relevel(month, c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")), y = precipitation_by_month)) +
  geom_col(fill = "lightgoldenrod2", colour = "lightseagreen")
